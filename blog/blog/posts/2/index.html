
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Blog - page 2 - Louis Li</title>
	<meta name="author" content="Louis Li">

	
	<meta name="description" content="
  
  

      
  
    
      
	
		











    1 July 2020

		


	istanbul, travel



		
	
	Traveling from Istanbul to Şile by Bus
	

          ...">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="fb:admins" content="100001696373537" />

	<link href="http://feeds.feedburner.com/louisligithub" rel="alternate" title="Louis Li" type="application/atom+xml">
	
	<link rel="canonical" href="http://louisrli.github.io/blog/blog/posts/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript"
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
          </script>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-5225926150102880",
          enable_page_level_ads: true
     });
</script>

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script type="text/javascript">
		$(function(){
                    $('.profilepic').append("<img src='https://www.gravatar.com/avatar/" + "9f050cf96c6cc933141f0242e5b723fd" + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Louis Li</a></h1>
  
</hgroup>

<p class="subtitle"></p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/categories/projects">Sideprojects</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="http://github.com/louisrli">Github</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="mailto:pong@outlook.com">Contact</a></li>
</ul>


<section class="aboutme">
  <p>
    Harvard student and developer.
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		<a class="github" href="https://github.com/louisrli" title="GitHub">GitHub</a>
		
		
		<a class="rss" href="http://feeds.feedburner.com/louisligithub" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner"><div class="blog-index">
  
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-07-01T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    1 July 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/istanbul/'>istanbul</a>, <a class='category' href='/blog/categories/travel/'>travel</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/07/01/istanbul-to-sile/" itemprop="url">Traveling from Istanbul to Şile by Bus</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>The intention of this post is to document how to travel from Istanbul to Şile by
bus. At the time of writing, there do not appear to be any English resources for
this route. The official IETT app and Google Maps both document this incorrectly.</p>


		<a href="/blog/2020/07/01/istanbul-to-sile/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-06-04T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    4 June 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/06/04/react-mathjax/" itemprop="url">Using MathJax with React</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>This post describes how to use React (Typescript) and MathJax.</p>


		<a href="/blog/2020/06/04/react-mathjax/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-06-04T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    4 June 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/06/04/react-dynamic-script-hook/" itemprop="url">Dynamic Script Loading in React with Hooks</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>This post describes how to dynamically load a script by adding a script tag to
your document using React Hooks.</p>


		<a href="/blog/2020/06/04/react-dynamic-script-hook/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-04-20T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    20 April 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/turkish/'>turkish</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/04/20/turkish-fiilimsi-verbal-derivatives/" itemprop="url">Fiilimsi: Turkish Verbal Nouns, Adjectives, and Adverbs</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <style>
blockquote {
  font-style: unset;
}

blockquote hr {
  margin: 0.3em 0;
}

blockquote p:first-child {
  font-size: 12px;
  border-bottom: 1px solid #ddd;
}

/* In case we want to bold the example headers later. */
blockquote p:first-child strong {
  font-weight: unset;
}

blockquote p {
  margin-top: 0.3em !important;
  margin-bottom: 0.3em !important;
}

</style>

<p>This post talks about the concept of “fiilimsi”, which are nouns, adjectives, or
adverbs derived from verbs. In English, for example, these include gerunds
(“<em>Running</em> is fun”) or participle adjectives (“The dog <em>that I saw</em>”).</p>

<p>This post is not intended to be a comprehensive resource of all fiilimsi.
There are three categories of fiilimsi:</p>

<ol>
  <li><strong>isim-fiil</strong>: verbal noun</li>
  <li><strong>sıfat-fiil</strong>: verbal adjective</li>
  <li><strong>zarf-fiil</strong>: verbal adverb</li>
</ol>

<p>There’s a noticeable lack of English language resources on the internet about
certain Turkish language topics. There’s a few articles about verbal derivations
but only with minimal details. I hope this post fills that niche.</p>

<p>Almost all of this material was derived from a lesson on the <a href="https://discord.me/turkceogrenelim">Türkçe Öğrenelim
Discord</a>. Feel free to join the community
and support them on <a href="https://www.patreon.com/letslearnturkish">Patreon</a>.</p>


		<a href="/blog/2020/04/20/turkish-fiilimsi-verbal-derivatives/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-02-21T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    21 February 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/istanbul/'>istanbul</a>, <a class='category' href='/blog/categories/travel/'>travel</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/02/21/sim-card/" itemprop="url">Sim Card Price in Turkey in February 2020</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>Getting a SIM card in Turkey for short to medium term stays in Turkey is
straightforward. In this article, I describe my experience with prices in
<em>February 2020</em> using Turkcell.</p>


		<a href="/blog/2020/02/21/sim-card/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-02-21T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    21 February 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/istanbul/'>istanbul</a>, <a class='category' href='/blog/categories/travel/'>travel</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/02/21/sahibinden/" itemprop="url">Sahibinden: The Craigslist of Turkey</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p><strong>Sahibinden</strong> (literally, “owners”) is the Craigslist equivalent of Turkey.</p>


		<a href="/blog/2020/02/21/sahibinden/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2020-02-21T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    21 February 2020
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/istanbul/'>istanbul</a>, <a class='category' href='/blog/categories/travel/'>travel</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2020/02/21/best-atm-in-istanbul-turkey/" itemprop="url">The Best ATM (No-Fee) in Istanbul, Turkey</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>The best ATM in Istanbul, Turkey is a coveted title. There’s a lot of banks that
accept international cards, but some of them will try to extract more money from
you via service fee or dynamic currency conversion (DCC).</p>

<p>The best ATM is <strong>HSBC</strong> (only 1000 lira at a time, mixed denominations).</p>


		<a href="/blog/2020/02/21/best-atm-in-istanbul-turkey/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2019-11-20T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    20 November 2019
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2019/11/20/staging-and-production-cookies-in-next-js/" itemprop="url">Staging and production cookies in Next.js</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>This article describes how add authentication to your
<a href="https://nextjs.org">Next.js</a> app using cookies and JWT. In this example, we
use cookies to authenticate against a GraphQL Yoga backend. Additionally, we
pass parameters based on the deployment stage (local, staging ,or production) of
our app.</p>

<!--more-->

<h2 id="deploy-stage-environmental-variable">Deploy stage environmental variable</h2>
<p>In this example, we are using <a href="TODO">Apex Up</a>, which automatically generates an
environmental variable <code class="language-plaintext highlighter-rouge">UP_STAGE</code>. Depending on your deployment process, you can
pass in the stage in a similar way.</p>

<p>We also pass in the following environmental variables:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">BACKEND_URI_STAGING</code>: The expected domain of the GraphQL backend in staging</li>
  <li><code class="language-plaintext highlighter-rouge">BACKEND_URI_PROD</code>: The expected domain of the GraphQL backend in prod</li>
</ul>

<p>In <code class="language-plaintext highlighter-rouge">next.config.js</code> in the root directory of your Next application:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Set up environmental variables for deployment. </span>
<span class="c1">// UP_STAGE comes with UP (https://github.com/apex/up-examples/tree/master/pro/env-static)</span>
<span class="kd">let</span> <span class="nx">backendUri</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://localhost:4000</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">cookieDomain</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UP_STAGE</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">staging</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">backendUri</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BACKEND_URI_STAGING</span><span class="p">;</span>
  <span class="c1">// Using a domain like foo.com includes all subdomains of foo.com.</span>
  <span class="nx">cookieDomain</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">stage.foo.com</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UP_STAGE</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">backendUri</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BACKEND_URI_PROD</span><span class="p">;</span>
  <span class="nx">cookieDomain</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">stage.foo.com</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UP_STAGE</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">backendUri</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">No backend URI found for : </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UP_STAGE</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Using backend URI: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">backendUri</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">withCss</span><span class="p">({</span>
  <span class="c1">// target: 'serverless',</span>
  <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">upStage</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UP_STAGE</span><span class="p">,</span>
    <span class="nx">backendUri</span><span class="p">,</span>
    <span class="nx">cookieDomain</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">})</span>
</code></pre></div></div>

		<a href="/blog/2019/11/20/staging-and-production-cookies-in-next-js/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2019-11-17T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    17 November 2019
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2019/11/17/next-js-with-antd/" itemprop="url">Next.js Typescript Integration with Ant Design (antd)</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>This article describes how to add the <a href="antd.design">Antd</a> library to
<a href="https://nextjs.org">Next.js</a>.</p>

<p>This is based off the
<a href="https://github.com/zeit/next.js/tree/canary/examples/with-ant-design">with-ant-design</a>
example in Next.js.</p>

<!--more-->

<h2 id="next-configuration">Next configuration</h2>
<p>In <code class="language-plaintext highlighter-rouge">next.config.js</code> in the root directory of your Next application, add the
following:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** See https://github.com/zeit/next.js/tree/canary/examples/with-ant-design */</span>
<span class="kd">const</span> <span class="nx">withCss</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@zeit/next-css</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">withCss</span><span class="p">({</span>
    <span class="na">webpack</span><span class="p">:</span> <span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">{</span> <span class="nx">isServer</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">antStyles</span> <span class="o">=</span> <span class="sr">/antd</span><span class="se">\/</span><span class="sr">.*</span><span class="se">?\/</span><span class="sr">style</span><span class="se">\/</span><span class="sr">css.*</span><span class="se">?</span><span class="sr">/</span>
      <span class="kd">const</span> <span class="nx">origExternals</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">config</span><span class="p">.</span><span class="nx">externals</span><span class="p">]</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">externals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">antStyles</span><span class="p">))</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">()</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">origExternals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">origExternals</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="nx">context</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">()</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">...(</span><span class="k">typeof</span> <span class="nx">origExternals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span> <span class="p">?</span> <span class="p">[]</span> <span class="p">:</span> <span class="nx">origExternals</span><span class="p">),</span>
      <span class="p">]</span>

      <span class="nx">config</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span>
        <span class="na">test</span><span class="p">:</span> <span class="nx">antStyles</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="dl">'</span><span class="s1">null-loader</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">})</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">config</span>
  <span class="p">},</span>
<span class="p">});</span>

</code></pre></div></div>

<p>In <code class="language-plaintext highlighter-rouge">babel.config.js</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">api</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">next/babel</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="dl">"</span><span class="s2">import</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">libraryName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">antd</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">style</span><span class="p">:</span> <span class="dl">'</span><span class="s1">css</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="p">]],</span>
  <span class="p">};</span>
<span class="p">};</span>

</code></pre></div></div>

<h2 id="example-usage">Example usage</h2>

<p>We are able to import from both <code class="language-plaintext highlighter-rouge">antd</code> and <code class="language-plaintext highlighter-rouge">antd/lib/&lt;component&gt;</code>.</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * An example that imports top-level components from 'antd' and also imports
 * from files under 'antd/lib'.
 */</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">TreeSelect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">antd</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">TreeSelectProps</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">antd/lib/tree-select</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">TreeSelectView</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="nx">TreeSelectProps</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">[]</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">TreeSelect</span>
      <span class="si">{</span><span class="p">...</span><span class="nx">props</span><span class="si">}</span>
      <span class="na">treeCheckable</span>
      <span class="na">treeData</span><span class="p">=</span><span class="si">{</span><span class="p">{}</span><span class="si">}</span>
      <span class="na">treeDefaultExpandAll</span>
      <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">width</span><span class="p">:</span> <span class="mi">300</span> <span class="p">}</span><span class="si">}</span>
      <span class="na">showCheckedStrategy</span><span class="p">=</span><span class="s">"SHOW_PARENT"</span>
      <span class="na">ref</span><span class="p">=</span><span class="si">{</span><span class="nx">ref</span><span class="si">}</span>
    <span class="p">/&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">forwardRef</span><span class="p">(</span><span class="nx">TreeSelectView</span><span class="p">);</span>

</code></pre></div></div>

		<a href="/blog/2019/11/17/next-js-with-antd/" class="more-link">Read more</a>
	</div>


    </article>
  

      
  
    <article>
      
	<div class="meta">
		<div class="date">










<time datetime="2019-11-17T00:00:00+08:00" data-updated="true" itemprop="datePublished">
    17 November 2019
</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/react/'>react</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2019/11/17/auth-redirect-next-js/" itemprop="url">HOC Authentication Redirects with Next.js, GraphQL, and Typescript</a></h1>
	<div class="entry-content" itemprop="articleBody">

          <p>This article describes how to redirect the user in
<a href="https://nextjs.org">Next.js</a> based on whether the user is authenticated
(logged in) using a properly typed Typescript React <a href="https://reactjs.org/docs/higher-order-components.html">higher-order
component</a> (HOC).</p>

<p>This can extend to arbitrary conditions on the queried user, such as redirecting
if the user does not have an active subscription.</p>

<!--more-->

<p>The following Typescript module implements a general HOC that redirects based on
authentication state by querying the user from the GraphQL backend. It then
includes two examples:</p>
<ul>
  <li>If the user is not logged in, redirect to <code class="language-plaintext highlighter-rouge">/login</code></li>
  <li>If the user is logged in, redirect to <code class="language-plaintext highlighter-rouge">/dashboard</code></li>
</ul>

<h2 id="example-hoc-usage">Example HOC Usage</h2>
<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NextPage</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next</span><span class="dl">'</span><span class="p">;</span>
<span class="c1">// CHANGE THIS: Export to the appropriate path.</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">withLoginRedirect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../lib/auth</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">RequiresLoginPage</span><span class="p">:</span> <span class="nx">NextPage</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>You're logged in<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">};</span>

<span class="c1">// If the user isn't logged in, this will redirect to `/login`.</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">withLoginRedirect</span><span class="p">(</span><span class="nx">RequiresLoginPage</span><span class="p">);</span>

</code></pre></div></div>

<h2 id="implementation">Implementation</h2>
<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NextComponentType</span><span class="p">,</span> <span class="nx">NextPageContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Router</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">gql</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">graphql-tag</span><span class="dl">'</span><span class="p">;</span>

<span class="cm">/**
 * YOU DEFINE THESE.
 *
 * These variables should be set by you to query for the user and the types
 * appropriately. I recommend using GraphQL codegen
 * (https://graphql-code-generator.com/) to generate types from your schema and
 * queries from other files so that they can be used like so:
 *
 * import { User } from '../generated/apollo-client-types';
 * import {
 *   LoggedInUserDocument,
 * } from '../generated/apollo-client-types';
 *
 */</span>
<span class="kr">interface</span> <span class="nx">User</span> <span class="p">{}</span>
<span class="kd">const</span> <span class="nx">LoggedInUserDocument</span> <span class="o">=</span> <span class="nx">gql</span><span class="s2">`&lt;YOUR QUERY FOR USER OBJECT&gt;`</span><span class="p">;</span>

<span class="cm">/**
 * A function that queries for the logged in user before rendering the page.
 * Should be called in getInitialProps. It redirects as desired.
 *
 * It allows for redirecting both if the user is not logged in (e.g., redirect
 * to login page) or redirecting if the user is logged in.
 *
 * If not logged in, redirects to the desired route.
 *
 * The return value indicates whether logic should continue or not after the
 * call.
 */</span>
<span class="kd">const</span> <span class="nx">redirectBasedOnLogin</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span>
  <span class="nx">ctx</span><span class="p">:</span> <span class="nx">NextPageContext</span><span class="p">,</span>
  <span class="nx">route</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
  <span class="nx">redirectIfAuthed</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isLoggedIn</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">apolloClient</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">({</span>
      <span class="na">query</span><span class="p">:</span> <span class="nx">LoggedInUserDocument</span><span class="p">,</span>
      <span class="c1">// Prevent caching issues when logging in/out without refresh.</span>
      <span class="na">fetchPolicy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">network-only</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">data</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">loggedInUser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">loggedInUser</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">shouldRedirect</span> <span class="o">=</span> <span class="nx">redirectIfAuthed</span> <span class="p">?</span> <span class="nx">isLoggedIn</span> <span class="p">:</span> <span class="o">!</span><span class="nx">isLoggedIn</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">shouldRedirect</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// https://github.com/zeit/next.js/wiki/Redirecting-in-%60getInitialProps%60</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">Location</span><span class="p">:</span> <span class="nx">route</span><span class="p">,</span>
      <span class="p">});</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**
 * General HOC that allows redirection based on authentication. We should not
 * expose this: instead export specific routes and redirect combinations.
 */</span>
<span class="kd">const</span> <span class="nx">withAuthRedirect</span> <span class="o">=</span> <span class="p">(</span><span class="nx">route</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">redirectIfAuthed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nx">P</span><span class="p">,</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">Page</span><span class="p">:</span> <span class="nx">NextComponentType</span><span class="o">&lt;</span><span class="nx">NextPageContext</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">P</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="nx">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">async</span> <span class="nx">getInitialProps</span><span class="p">(</span><span class="na">ctx</span><span class="p">:</span> <span class="nx">NextPageContext</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">shouldContinue</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">redirectBasedOnLogin</span><span class="p">(</span>
        <span class="nx">ctx</span><span class="p">,</span>
        <span class="nx">route</span><span class="p">,</span>
        <span class="nx">redirectIfAuthed</span>
      <span class="p">);</span>
      <span class="c1">// Only continue if we're logged in. Otherwise, it might cause an</span>
      <span class="c1">// unnecessary call to a downstream getInitialProps that requires</span>
      <span class="c1">// authentication.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldContinue</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{};</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Page</span><span class="p">.</span><span class="nx">getInitialProps</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Page</span><span class="p">.</span><span class="nx">getInitialProps</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Page</span> <span class="si">{</span><span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="si">}</span> <span class="p">/&gt;;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="cm">/**
 * HOC that redirects to login page if the user is not logged in.
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">withLoginRedirect</span> <span class="o">=</span> <span class="nx">withAuthRedirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="cm">/**
 * HOC that redirects to the dashboard if the user is logged in.
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">withDashboardRedirect</span> <span class="o">=</span> <span class="nx">withAuthRedirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/dashboard</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

</code></pre></div></div>

<p>Found this helpful or have suggestions? Leave them in the comments below.</p>

<p>Typing Next.js <code class="language-plaintext highlighter-rouge">getInitialProps</code> HOCs is tricky, and I had trouble finding an
example online.</p>

<h2 id="versions">Versions</h2>
<p>At the time of writing, this was using Next 9.</p>

		<a href="/blog/2019/11/17/auth-redirect-next-js/" class="more-link">Read more</a>
	</div>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="1">Newer &rarr;</a>
    
  </div>
</div>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2022 - Louis Li
</p>

Theme originally by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'llgithub';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-32823730-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
